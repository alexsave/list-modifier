E='Element',e=null,f=0,h=[],i=0,k=[],n=0,s=[],C=_=>(h.map(y=>y.style.border=''),h=[]),H=v=>(v[p='preventDefault'](),v.stopPropagation(),l=v.target,n&&(v.type===m?R(l,C()):v.type===c&&(n=0,d[r='removeEventListener'](m,H),d[r](c,H),h.length>0&&(d[A](Y,v=>((v.ctrlKey||v.metaKey)&&v.key==='z'&&(v[p](),k.length&&([z,o]=k.pop(),(o?o:d.body)[P](z))))),d.querySelectorAll('a').forEach(v=>v.setAttribute('target','_blank')),h.forEach(z=>(b=d.createElement('button'),b.textContent='Delete',b[A](c,v=>(v[p](),k.length>4&&k.shift(),k.push([z,z[Q]]),z.remove())),z[P='appendChild'](b))),s=[...h],h.forEach(b=>(b[A]('dragstart',v=>(v.dataTransfer.setData('text/plain',''),i=1,e=b)),b[A]('dragend',_=>(i=0,e=null)))),d[A]('dragover',v=>(v[p](),i&&(t=v.target,(_=>{while(!s.includes(t)){t=t[Q];if(t===d[D]||t===d.body)return}t!==e&&(y=t[Q],l=[...y[I]],w=l.indexOf(e),x=l.indexOf(t),(w>-1&&x>-1)&&y.insertBefore(w<x?t:e,w<x?e:t))})()))),d[A]('mousemove',v=>i&&(y=e.style,y.position='fixed',y.top=v.clientY-e.clientHeight/2+'px',y.left=v.clientX-e.clientWidth/2+'px')),C())))),R=l=>l&&!l[D='document'+E]&&l!=d.body&&(y=[...l[I='children']],(y.length>2&&y.filter((x,j)=>j&&x.classList[0]==y[0].classList[0]).length/y.length>.33)?(h.push(...y),y.forEach(x=>x.style.border='2px solid red')):R(l[Q='parent'+E])),(d=document)[A='addEventListener'](Y='keydown',v=>(v.key==='Shift'&&(u=new Date().getTime(),(u-f<300)&&(n=1,d[A](m='mouseover',H),d[A](c='click',H)),f=u)))
